# CVE-2018-12714 Postmortem

## Summary

An issue was discovered in the Linux kernel through 4.17.2. The filter parsing in kernel/trace/trace_events_filter.c could be called with no filter, which is an N=0 case when it expected at least one line to have been read, thus making the N-1 index invalid. This allows attackers to cause a denial of service (slab out-of-bounds write) or possibly have unspecified other impact via crafted perf_event_open and mmap system calls.

## Root Causes

```c
static struct prog_entry *
predicate_parse(const char *str, int nr_parens, int nr_preds,
		parse_pred_fn parse_pred, void *data,
		struct filter_parse_error *pe)
{
// --snip--
//	if (!N) { <= The patch to fix it
//		/* No program? */
//		ret = -EINVAL;
//		parse_error(pe, FILT_ERR_NO_FILTER, ptr - str);
//		goto out_free;
//	}

	prog[N].pred = NULL;					/* #13 */
	prog[N].target = 1;		/* TRUE */
	prog[N+1].pred = NULL;
	prog[N+1].target = 0;		/* FALSE */
	prog[N-1].target = N; // <= out-of-bounds write when N = 0
	prog[N-1].when_to_branch = false;
```

## Resolution

xxx

## File

* kernel/trace/trace_events_filter.c

## Timeline

### 2018-06-21 13:20:53 -0400

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=70303420b5721c38998cf987e6b7d30cc62d4ff1

Fixed by Steven Rostedt (VMware).

### 2018-06-24 06:23:28 +0800

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=81f9c4e4177d31ced6f52a89bb70e93bfb77ca03

Merged by Linus Torvalds.

## Supporting information

* CVE: https://www.cvedetails.com/cve/CVE-2018-12714/
* NVD: https://nvd.nist.gov/vuln/detail/CVE-2018-12714
