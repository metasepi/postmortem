# CVE-2019-11815 Postmortem

## Summary

An issue was discovered in rds_tcp_kill_sock in net/rds/tcp.c in the Linux kernel before 5.0.8. There is a race condition leading to a use-after-free, related to net namespace cleanup.

## Root Causes

* The use-after-free occurred in `inet_create` function.
* The object was `net`.

```c
static int inet_create(struct net *net, struct socket *sock, int protocol,
		       int kern)
{
// --snip--
	if (SOCK_RAW == sock->type) {
		inet->inet_num = protocol;
		if (IPPROTO_RAW == protocol)
			inet->hdrincl = 1;
	}

	if (net->ipv4.sysctl_ip_no_pmtu_disc) // // <= use-after-free
		inet->pmtudisc = IP_PMTUDISC_DONT;
	else
		inet->pmtudisc = IP_PMTUDISC_WANT;
```

## Resolution

xxx

## File

* net/rds/tcp.c

## Timeline

### 2019-03-28 17:10:56 +0800

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cb66ddd156203daefb8d71158036b27b0e2caf63

Fixed by Mao Wenan.

## Supporting information

* CVE: https://www.cvedetails.com/cve/CVE-2019-11815/
* NVD: https://nvd.nist.gov/vuln/detail/CVE-2019-11815
