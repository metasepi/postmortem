# CVE-2019-15926 Postmortem

## Summary

An issue was discovered in the Linux kernel before 5.2.3. Out of bounds access exists in the functions ath6kl_wmi_pstream_timeout_event_rx and ath6kl_wmi_cac_event_rx in the file drivers/net/wireless/ath/ath6kl/wmi.c.

## Root Causes

Initial code caused out of bounds access such as following:

```c
static int ath6kl_wmi_pstream_timeout_event_rx(struct wmi *wmi, u8 *datap,
					       int len)
{
	struct wmi_pstream_timeout_event *ev;

	if (len < sizeof(struct wmi_pstream_timeout_event))
		return -EINVAL;

	ev = (struct wmi_pstream_timeout_event *) datap;
//	if (ev->traffic_class >= WMM_NUM_AC) { // <= The patch to fix it
//		ath6kl_err("invalid traffic class: %d\n", ev->traffic_class);
//		return -EINVAL;
//	}

	/*
	 * When the pstream (fat pipe == AC) timesout, it means there were
	 * no thinStreams within this pstream & it got implicitly created
	 * due to data flow on this AC. We start the inactivity timer only
	 * for implicitly created pstream. Just reset the host state.
	 */
	spin_lock_bh(&wmi->lock);
	wmi->stream_exist_for_ac[ev->traffic_class] = 0; // <= Out of bounds access
	wmi->fat_pipe_exist &= ~(1 << ev->traffic_class);
	spin_unlock_bh(&wmi->lock);
```

## Resolution

xxx

## File

* drivers/net/wireless/ath/ath6kl/wmi.c

## Timeline

### 2011-07-18 00:22:30 +0300

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=bdcd81707973cf8aa9305337166f8ee842a050d4

Caused by Kalle Valo. This is the initial code.

### 2019-04-04 11:56:51 +0300

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=5d6751eaff672ea77642e74e92e6c0ac7f9709ab

Fixed by Dan Carpenter.

## Supporting information

* CVE: https://www.cvedetails.com/cve/CVE-2019-15926/
* NVD: https://nvd.nist.gov/vuln/detail/CVE-2019-15926
