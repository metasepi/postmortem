# CVE-2017-12762 Postmortem

## Summary

In /drivers/isdn/i4l/isdn_net.c: A user-controlled buffer is copied into a local buffer of constant size using strcpy without a length check which can cause a buffer overflow. This affects the Linux kernel 4.9-stable tree, 4.12-stable tree, 3.18-stable tree, and 4.4-stable tree.

## Root Causes

```c
static int
isdn_ioctl(struct file *file, uint cmd, ulong arg)
{
	uint minor = iminor(file_inode(file));
	isdn_ctrl c;
	int drvidx;
	int ret;
	int i;
	char __user *p;
	char *s;
	union iocpar {
		char name[10];
		char bname[22];
		isdn_ioctl_struct iocts;
		isdn_net_ioctl_phone phone;
		isdn_net_ioctl_cfg cfg;
	} iocpar;
	void __user *argp = (void __user *)arg;

#define name  iocpar.name
#define bname iocpar.bname
// --snip--
		case IIOCNETASL:
			/* Add a slave to a network-interface */
			if (arg) {
				if (copy_from_user(bname, argp, sizeof(bname) - 1))
					return -EFAULT;
//				bname[sizeof(bname)-1] = 0; // <= The patch to fix it
			} else
				return -EINVAL;
			ret = mutex_lock_interruptible(&dev->mtx);
			if (ret) return ret;
			if ((s = isdn_net_newslave(bname))) {
// --snip--
char *
isdn_net_newslave(char *parm)
{
	char *p = strchr(parm, ',');
	isdn_net_dev *n;
	char newname[10];

	if (p) {
		/* Slave-Name MUST not be empty */
		if (!strlen(p + 1))
 			return NULL;
		strcpy(newname, p + 1); // <= It causes buffer overflow
//		/* Slave-Name MUST not be empty or overflow 'newname' */
//		if (strscpy(newname, p + 1, sizeof(newname)) <= 0) // <= The patch to fix it
//			return NULL;
		*p = 0;
```

## Resolution

xxx

## File

* drivers/isdn/i4l/isdn_common.c
* drivers/isdn/i4l/isdn_net.c

## Timeline

### Sat Jul 15 15:08:58 2017 -0600

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9f5af546e6acc30f075828cb58c7f09665033967

Fixed by Annie Cherkaev.

## Supporting information

* CVE: https://www.cvedetails.com/cve/CVE-2017-12762/
* NVD: https://nvd.nist.gov/vuln/detail/CVE-2017-12762
